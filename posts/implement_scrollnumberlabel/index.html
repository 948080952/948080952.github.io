<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="iOS开发," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="写在前面第一次写博客，有点小激动，同时也害怕写的很烂，所以希望大家能够包容，如果大家觉得看不下去我的博客，可以直接翻到最后有源码和demo的github地址。开发ios也有大半年了，所以想要尝试一下写点博客，好了废话不多说了下面开始正题了。
正文简介由于公司前段时间项目里要用到一个可以滚动的数字标签，所以就写了这样一个控件，现在有时间了，就写篇博客记录一下实现这个控件的过程。上一张gif动画">
<meta property="og:type" content="article">
<meta property="og:title" content="自己实现的一个可以滚动展示数字的控件：DPScrollNumberLabel">
<meta property="og:url" content="https://948080952.github.io/posts/implement_scrollnumberlabel/index.html">
<meta property="og:site_name" content="DaiPei's Blog">
<meta property="og:description" content="写在前面第一次写博客，有点小激动，同时也害怕写的很烂，所以希望大家能够包容，如果大家觉得看不下去我的博客，可以直接翻到最后有源码和demo的github地址。开发ios也有大半年了，所以想要尝试一下写点博客，好了废话不多说了下面开始正题了。
正文简介由于公司前段时间项目里要用到一个可以滚动的数字标签，所以就写了这样一个控件，现在有时间了，就写篇博客记录一下实现这个控件的过程。上一张gif动画">
<meta property="og:image" content="https://948080952.github.io/posts/implement_scrollnumberlabel/1.gif">
<meta property="og:updated_time" content="2017-06-10T05:42:45.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="自己实现的一个可以滚动展示数字的控件：DPScrollNumberLabel">
<meta name="twitter:description" content="写在前面第一次写博客，有点小激动，同时也害怕写的很烂，所以希望大家能够包容，如果大家觉得看不下去我的博客，可以直接翻到最后有源码和demo的github地址。开发ios也有大半年了，所以想要尝试一下写点博客，好了废话不多说了下面开始正题了。
正文简介由于公司前段时间项目里要用到一个可以滚动的数字标签，所以就写了这样一个控件，现在有时间了，就写篇博客记录一下实现这个控件的过程。上一张gif动画">
<meta name="twitter:image" content="https://948080952.github.io/posts/implement_scrollnumberlabel/1.gif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://948080952.github.io/posts/implement_scrollnumberlabel/"/>





  <title>自己实现的一个可以滚动展示数字的控件：DPScrollNumberLabel | DaiPei's Blog</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  















  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">DaiPei's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            Commonweal 404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://948080952.github.io/posts/implement_scrollnumberlabel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="DaiPei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/daipei.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DaiPei's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">自己实现的一个可以滚动展示数字的控件：DPScrollNumberLabel</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-10T14:47:20+08:00">
                2016-07-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a class="cloud-tie-join-count" href="/posts/implement_scrollnumberlabel/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count join-count" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>第一次写博客，有点小激动，同时也害怕写的很烂，所以希望大家能够包容，如果大家觉得看不下去我的博客，可以直接翻到最后有源码和demo的github地址。开发ios也有大半年了，所以想要尝试一下写点博客，好了废话不多说了下面开始正题了。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>由于公司前段时间项目里要用到一个可以滚动的数字标签，所以就写了这样一个控件，现在有时间了，就写篇博客记录一下实现这个控件的过程。<br><br><br><strong>上一张gif动画</strong>        </p>
<img src="/posts/implement_scrollnumberlabel/1.gif" alt="image" title="image">
<p>​<br>这个控件的逻辑是当个位数从0~9~0时十位数向上滚动1，当十位完成一个0~9~0循环时，百位向上滚动1依次类推</p>
<a id="more"></a>
<h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><p>先说一下我实现这个控件的思路，其实比较简单，数字的每一列都是一个很长的UILabel，然后由上至下是数字0~9，当数字改变时，让这个label上下移动，产生滚动的动画，只需要计算循环的次数，滚动的方向，滚动的时间就可以了。</p>
<h3 id="Talk-is-cheap，show-you-The-code！"><a href="#Talk-is-cheap，show-you-The-code！" class="headerlink" title="Talk is cheap，show you The code！"></a>Talk is cheap，show you The code！</h3><h4 id="首先看一下头文件里的内容："><a href="#首先看一下头文件里的内容：" class="headerlink" title="首先看一下头文件里的内容："></a>首先看一下头文件里的内容：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">//</div><div class="line">//  DPScrollNumberLabel.h</div><div class="line">//  DPScrollNumberLabelDemo</div><div class="line">//</div><div class="line">//  Created by Dai Pei on 16/5/23.</div><div class="line">//  Copyright © 2016年 Dai Pei. All rights reserved.</div><div class="line">//</div><div class="line"></div><div class="line"></div><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line"></div><div class="line">@interface DPScrollNumberLabel : UIView</div><div class="line"></div><div class="line">@property (nonatomic, strong)NSNumber *displayedNumber;</div><div class="line"></div><div class="line">- (instancetype)initWithNumber:(NSNumber *)originNumber fontSize:(CGFloat)size;</div><div class="line">- (instancetype)initWithNumber:(NSNumber *)originNumber fontSize:(CGFloat)size textColor:(UIColor *)color;</div><div class="line">- (instancetype)initWithNumber:(NSNumber *)originNumber font:(UIFont *)font;</div><div class="line">- (instancetype)initWithNumber:(NSNumber *)originNumber font:(UIFont *)font textColor:(UIColor *)color;</div><div class="line">- (instancetype)initWithNumber:(NSNumber *)originNumber fontSize:(CGFloat)size rowNumber:(NSUInteger)rowNumber;</div><div class="line">- (instancetype)initWithNumber:(NSNumber *)originNumber fontSize:(CGFloat)size textColor:(UIColor *)color rowNumber:(NSUInteger)rowNumber;</div><div class="line">- (instancetype)initWithNumber:(NSNumber *)originNumber font:(UIFont *)font textColor:(UIColor *)color rowNumber:(NSUInteger)rowNumber;//rowNumber should less than or equal 8</div><div class="line"></div><div class="line">- (void)changeToNumber:(NSNumber *)number animated:(BOOL)animated;</div><div class="line">- (void)changeToNumber:(NSNumber *)number interval:(CGFloat)interval animated:(BOOL)animated;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>可以看到头文件里有7个初始化方法，分为两大类：规定列数和不规定列数。当规定列数时，则控件的列数固定，当传入的数字大于列数限制时函数直接返回，当不规定列数时，以初始化传入的数字的列数为初始列数，当后面传入的数字大于初始列数时，会自动在左边补加列（最大列数不能超过8列）<br><br>其中最重要的一个参数是字体的大小，我需要这个参数去计算此控件的大小。<br>另外两个方法当需要显示的数字改变时调用，animated传入YES时会有动画，传入NO时直接改变不播放动画。</p>
<h4 id="下面只贴上其中一个init方法："><a href="#下面只贴上其中一个init方法：" class="headerlink" title="下面只贴上其中一个init方法："></a>下面只贴上其中一个init方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (instancetype)initWithNumber:(NSNumber *)originNumber fontSize:(CGFloat)size textColor:(UIColor *)color rowNumber:(NSUInteger)rowNumber &#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self) &#123;</div><div class="line">        self.displayedNumber = originNumber;</div><div class="line">        self.font = [UIFont systemFontOfSize:size];</div><div class="line">        self.textColor = color;</div><div class="line">        self.isAnimation = NO;</div><div class="line">        self.finishedAnimationCount = 0;</div><div class="line">        self.rowNumber = (rowNumber &gt; 0 &amp;&amp; rowNumber &lt;= 8) ? rowNumber : 0;</div><div class="line">        self.maxRowNumber = (self.rowNumber == 0) ? 8 : rowNumber;</div><div class="line">        [self commonInit];</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="初始化后进入commonInit方法："><a href="#初始化后进入commonInit方法：" class="headerlink" title="初始化后进入commonInit方法："></a>初始化后进入commonInit方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)commonInit &#123;</div><div class="line">    [self initCell];</div><div class="line">    [self initParent];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="然后先初始化cell，再初始化parent："><a href="#然后先初始化cell，再初始化parent：" class="headerlink" title="然后先初始化cell，再初始化parent："></a>然后先初始化cell，再初始化parent：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">- (void)initCell &#123;</div><div class="line">    int originNumber = self.displayedNumber.intValue;</div><div class="line">    //如果没有规定列数 就自己计算 方法具体实现会在后面贴出</div><div class="line">    if (self.rowNumber == 0) &#123;</div><div class="line">        self.rowNumber = [self calculateRowNumber:originNumber];</div><div class="line">    &#125;</div><div class="line">    //用于保存所有的cell</div><div class="line">    self.cellArray = [[NSMutableArray alloc] init];</div><div class="line">    NSString *text = @&quot;0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n0&quot;;</div><div class="line">    //这个方法很赞 可以直接根据内容来计算一个view的大小</div><div class="line">    CGRect rect = [text boundingRectWithSize:CGSizeZero</div><div class="line">    options:NSStringDrawingUsesLineFragmentOrigin</div><div class="line">attributes:@&#123;NSFontAttributeName:self.font&#125; context:nil];</div><div class="line">	//然后保存宽度和高度值，后面很多地方都会用到</div><div class="line">    self.cellWidth = rect.size.width;</div><div class="line">    self.cellHeight = rect.size.height;</div><div class="line">    //拿到每个位数上显示的数字并保存在一个数组中</div><div class="line">    NSArray *displayNumberArray = [self getCellDisplayNumberWithNumber:self.displayedNumber.integerValue];</div><div class="line">    //初始化每个cell 并且保存在数组中</div><div class="line">    for (NSInteger i = 0; i &lt; self.rowNumber; i++) &#123;</div><div class="line">        UILabel *scrollCell = [self makeScrollCell];</div><div class="line">        scrollCell.frame = CGRectMake((self.rowNumber - 1 - i) * self.cellWidth, 0, self.cellWidth, self.cellHeight);</div><div class="line">        scrollCell.text = text;</div><div class="line">        NSNumber *displayNum = [displayNumberArray objectAtIndex:i];</div><div class="line">        //此方法调整cell的位置，使其显示相应的数字 方法具体实现会在后面贴出</div><div class="line">        [self setScrollCell:scrollCell toNumber:displayNum.integerValue];</div><div class="line">        [self.cellArray addObject:scrollCell];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">#pragma mark - Getters</div><div class="line">- (UILabel *)makeScrollCell &#123;</div><div class="line">    UILabel *cell = [[UILabel alloc] init];</div><div class="line">    cell.font = self.font;</div><div class="line">    cell.numberOfLines = 11;</div><div class="line">    cell.textColor = self.textColor;</div><div class="line">    return  cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后是实现parent：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (void)initParent&#123;</div><div class="line">    self.bounds = CGRectMake(0, 0, self.rowNumber * self.cellWidth, self.cellHeight / 11);</div><div class="line">    self.backgroundColor = [UIColor clearColor];</div><div class="line">    self.layer.masksToBounds = YES;</div><div class="line">    //把cell布局到parent中 </div><div class="line">    [self layoutCell:self.rowNumber withAnimation:YES];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">- (void)layoutCell:(NSUInteger)rowNumber withAnimation:(BOOL)animated&#123;</div><div class="line">    //先将子view全部移除 此处移除是有原因的</div><div class="line">    for (UIView *subView in self.subviews) &#123;</div><div class="line">        [subView removeFromSuperview];</div><div class="line">    &#125;</div><div class="line">    //再添加进去</div><div class="line">    for (UILabel *cell in self.cellArray) &#123;</div><div class="line">        [self addSubview:cell];</div><div class="line">    &#125;</div><div class="line">    //此处用动画重新排列所有的cell</div><div class="line">    __weak typeof(self) weakSelf = self;</div><div class="line">    [UIView animateWithDuration:0.2 * (rowNumber - self.rowNumber) animations:^&#123;</div><div class="line">        for (int i = 0; i &lt; rowNumber; i++) &#123;</div><div class="line">            UILabel *cell = [weakSelf.cellArray objectAtIndex:i];</div><div class="line">            cell.frame = CGRectMake((rowNumber - 1 - i) * weakSelf.cellWidth,</div><div class="line">                                    cell.frame.origin.y,</div><div class="line">                                    weakSelf.cellWidth,</div><div class="line">                                    weakSelf.cellHeight);</div><div class="line">        &#125;</div><div class="line">        self.frame = CGRectMake(self.frame.origin.x,</div><div class="line">                                self.frame.origin.y,</div><div class="line">                                rowNumber * self.cellWidth,</div><div class="line">                                self.cellHeight/11);</div><div class="line">    &#125; completion:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>至此，初始化的工作全部完成</p>
<h4 id="下面让我们关注头文件里另外的两个公有方法："><a href="#下面让我们关注头文件里另外的两个公有方法：" class="headerlink" title="下面让我们关注头文件里另外的两个公有方法："></a>下面让我们关注头文件里另外的两个公有方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">- (void)changeToNumber:(NSNumber *)number animated:(BOOL)animated &#123;</div><div class="line">- </div><div class="line">    [self changeToNumber:number interval:0 animated:animated];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)changeToNumber:(NSNumber *)number interval:(CGFloat)interval animated:(BOOL)animated &#123;</div><div class="line">    //因为没有做负数部分，所以当传入的数字小于0 直接返回</div><div class="line">    if (number.integerValue &lt; 0) &#123;</div><div class="line">        return ;</div><div class="line">    &#125;</div><div class="line">    //当大于最大行数，直接返回</div><div class="line">    if ([self calculateRowNumber:number.integerValue] &gt; self.maxRowNumber) &#123;</div><div class="line">        return ;</div><div class="line">    &#125;</div><div class="line">    //如果传入数字和本身显示相同，直接返回</div><div class="line">    if (number.integerValue == self.displayedNumber.integerValue) &#123;</div><div class="line">        return ;</div><div class="line">    &#125;</div><div class="line">    //当传入数字时，当前动画还没有播放完成，加入数组，等待动画播放完成</div><div class="line">    if (self.isAnimation) &#123;</div><div class="line">        if (!self.taskArray) &#123;</div><div class="line">            self.taskArray = [NSMutableArray array];</div><div class="line">        &#125;</div><div class="line">        [self.taskArray addObject:@&#123;keyTaskDisplayNumber:number, keyTaskChangeNumber:@(number.integerValue - self.displayedNumber.integerValue),keyTaskInterval:@(interval)&#125;];</div><div class="line">    &#125;else &#123;</div><div class="line">        if (animated) &#123;</div><div class="line">        //animated 为YES时 进入此方法</div><div class="line">            [self playAnimationWithChange:number.integerValue - self.displayedNumber.integerValue displayNumber:number interval:interval];</div><div class="line">            self.isAnimation = YES;</div><div class="line">        &#125;else &#123;</div><div class="line">        //animated 为NO时 直接改变</div><div class="line">        //这个方法在前面说过，具体实现会在后面贴出</div><div class="line">            NSArray&lt;NSNumber *&gt; *displayNumbers = [self getCellDisplayNumberWithNumber:number.integerValue];</div><div class="line">            for (int i = 0; i &lt; displayNumbers.count; i++) &#123;</div><div class="line">                [self setScrollCell:self.cellArray[i] toNumber:displayNumbers[i].integerValue];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    self.displayedNumber = number;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="下面就要进入动画部分了"><a href="#下面就要进入动画部分了" class="headerlink" title="下面就要进入动画部分了"></a>下面就要进入动画部分了</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">static const CGFloat bufferModulus = 0.7f;</div><div class="line"></div><div class="line">- (void)playAnimationWithChange:(NSInteger)changeNumber displayNumber:(NSNumber *)displayNumber interval:(CGFloat)interval&#123;</div><div class="line">    //改名后的列数</div><div class="line">    NSInteger nextRowNumber = [self calculateRowNumber:displayNumber.intValue];</div><div class="line">    //只有当列数增加时才重新布局</div><div class="line">    if (nextRowNumber &gt; self.rowNumber) &#123;</div><div class="line">        [self reInitCell:nextRowNumber];</div><div class="line">        [self layoutCell:nextRowNumber withAnimation:YES];</div><div class="line">        self.rowNumber = nextRowNumber;</div><div class="line">    &#125;</div><div class="line">    //储存每一位循环次数的数组</div><div class="line">    NSArray *repeatCountArray = [self getRepeatTimesWithChangeNumber:changeNumber displayNumber:displayNumber.integerValue];</div><div class="line">    //储存每一位将显示的数值</div><div class="line">    NSArray *willDisplayNums = [self getCellDisplayNumberWithNumber:displayNumber.integerValue];</div><div class="line">    </div><div class="line">    //如果没有设置动画间隔，则根据改变的大小来进行计算</div><div class="line">    if (interval == 0) &#123;</div><div class="line">        interval = [self getIntervalWithOriginalNumber:displayNumber.integerValue - changeNumber displayNumber:displayNumber.integerValue];</div><div class="line">    &#125;</div><div class="line">    //获得滚动的方向</div><div class="line">    ScrollAnimationDirection direction = (changeNumber &gt; 0)? ScrollAnimationDirectionUp : ScrollAnimationDirectionDown;</div><div class="line">    </div><div class="line">    CGFloat delay = 0.0f;</div><div class="line">    </div><div class="line">    if (repeatCountArray.count != 0) &#123;</div><div class="line">        for (NSInteger i = 0; i &lt; repeatCountArray.count; i++) &#123;</div><div class="line">            NSNumber *repeat = [repeatCountArray objectAtIndex:i];</div><div class="line">            NSInteger repeatCount = repeat.integerValue;</div><div class="line">            NSNumber *willDisplayNum = [willDisplayNums objectAtIndex:i];</div><div class="line">            UILabel *cell = [self.cellArray objectAtIndex:i];</div><div class="line">            CGFloat startDuration = 0;</div><div class="line">            //当不是一个完整0~9~0循环时，只进行一个Single动画（我将这里的动画分为两类：single和multi）</div><div class="line">            if (repeatCount == 0) &#123;</div><div class="line">                [self makeSingleAnimationWithCell:cell duration:interval delay:delay animationCount:repeatCountArray.count displayNumber:willDisplayNum.integerValue];</div><div class="line">            &#125;else &#123;</div><div class="line">            //当&gt;=一个循环时，进行multi动画</div><div class="line">                if (direction == ScrollAnimationDirectionUp) &#123;</div><div class="line">                //此处计算三个部分的动画时间</div><div class="line">                    startDuration = interval * (10 - [self getDisplayNumberOfCell:cell]) / ceilf(fabs(changeNumber / pow(10, i)));</div><div class="line">                    CGFloat cycleDuration = interval * 10 / fabs(changeNumber / pow(10, i));</div><div class="line">                    if (repeatCount == 1) &#123;</div><div class="line">                        cycleDuration = 0;</div><div class="line">                    &#125;</div><div class="line">                    CGFloat endDuration = bufferModulus * pow(willDisplayNum.integerValue, 0.3) / (i + 1);</div><div class="line">                    NSDictionary *attribute = @&#123;keyStartDuration:   @(startDuration),</div><div class="line">                                                keyStartDelay:      @(delay),</div><div class="line">                                                keyCycleDuration:   @(cycleDuration),</div><div class="line">                                                keyEndDuration:     @(endDuration),</div><div class="line">                                                keyRepeatCount:     @(repeatCount - 1),</div><div class="line">                                                keyDisplayNumber:   willDisplayNum&#125;;</div><div class="line">                    [self makeMultiAnimationWithCell:cell direction:direction animationCount:repeatCountArray.count attribute:attribute];</div><div class="line">                &#125;else if (direction == ScrollAnimationDirectionDown) &#123;</div><div class="line">                    startDuration = interval * ([self getDisplayNumberOfCell:cell] - 0) / ceilf(fabs(changeNumber / pow(10, i)));</div><div class="line">                    CGFloat cycleDuration = interval * 10 / fabs(changeNumber / pow(10, i));</div><div class="line">                    //此处可能有些疑问，因为这个repeatCount不是真正循环的次数，是cycle的次数加end部分的1，所以如果repeat为1 真正循环次数是0</div><div class="line">                    if (repeatCount == 1) &#123;</div><div class="line">                        cycleDuration = 0;</div><div class="line">                    &#125;</div><div class="line">                    CGFloat endDuration = bufferModulus * pow(10 - willDisplayNum.integerValue, 0.3) / (i + 1);</div><div class="line">                    NSDictionary *attribute = @&#123;keyStartDuration:   @(startDuration),</div><div class="line">                                                keyStartDelay:      @(delay),</div><div class="line">                                                keyCycleDuration:   @(cycleDuration),</div><div class="line">                                                keyEndDuration:     @(endDuration),</div><div class="line">                                                keyRepeatCount:     @(repeatCount - 1),</div><div class="line">                                                keyDisplayNumber:   willDisplayNum&#125;;</div><div class="line">                    [self makeMultiAnimationWithCell:cell direction:direction animationCount:repeatCountArray.count attribute:attribute];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            delay = delay + startDuration;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>动画分为single和multi两种，multi动画里包括3个部分start，cycle，end；start部分是当前数值~9的动画，cycle部分是0~9的数次循环，end部分为0~最终数值（此处以数字增加举例，数字减少时相反）</p>
<h4 id="下面贴出single和multi两种动画的代码："><a href="#下面贴出single和multi两种动画的代码：" class="headerlink" title="下面贴出single和multi两种动画的代码："></a>下面贴出single和multi两种动画的代码：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">- (void)makeSingleAnimationWithCell:(UILabel *)cell duration:(CGFloat)duration delay:(CGFloat)delay animationCount:(NSInteger)count displayNumber:(NSInteger)displayNumber&#123;</div><div class="line">    </div><div class="line">    [UIView animateWithDuration:duration delay:delay options:UIViewAnimationOptionCurveEaseOut animations:^&#123;</div><div class="line">        [self setScrollCell:cell toNumber:displayNumber];</div><div class="line">    &#125; completion:^(BOOL finished) &#123;</div><div class="line">    //当动画结束，检查是否有待执行的动画</div><div class="line">        [self checkTaskArrayWithAnimationCount:count];</div><div class="line">        NSLog(@&quot;single animation finish!&quot;);</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line">- (void)makeMultiAnimationWithCell:(UILabel *)cell</div><div class="line">                         direction:(ScrollAnimationDirection)direction</div><div class="line">                    animationCount:(NSInteger)count</div><div class="line">                         attribute:(NSDictionary *)attribute&#123;</div><div class="line">    NSNumber *startDuration = [attribute objectForKey:keyStartDuration];</div><div class="line">    NSNumber *cycleDuration = [attribute objectForKey:keyCycleDuration];</div><div class="line">    NSNumber *endDuration = [attribute objectForKey:keyEndDuration];</div><div class="line">    NSNumber *repeatCount = [attribute objectForKey:keyRepeatCount];</div><div class="line">    NSNumber *willDisplayNum = [attribute objectForKey:keyDisplayNumber];</div><div class="line">    NSNumber *startDelay = [attribute objectForKey:keyStartDelay];</div><div class="line">    </div><div class="line">    [UIView animateWithDuration:startDuration.floatValue delay:startDelay.floatValue options:UIViewAnimationOptionCurveEaseIn animations:^&#123;</div><div class="line">    //这是开始部分的动画</div><div class="line">        [self setScrollCell:cell toNumber:(direction == ScrollAnimationDirectionUp)?10 : 0];</div><div class="line">    &#125; completion:^(BOOL finished) &#123;</div><div class="line">        NSLog(@&quot;start animation finish!&quot;);</div><div class="line">        //开始动画结束后将cell归位到循环开始的地方</div><div class="line">        [self setScrollCell:cell toNumber:(direction == ScrollAnimationDirectionUp)?0 : 10];</div><div class="line">        </div><div class="line">        if (cycleDuration.floatValue == 0) &#123;</div><div class="line">        //当循环次数为0，直接执行结束部分的动画</div><div class="line">            [UIView animateWithDuration:endDuration.floatValue delay:0 options:UIViewAnimationOptionCurveEaseOut animations:^&#123;</div><div class="line">                [self setScrollCell:cell toNumber:willDisplayNum.integerValue];</div><div class="line">            &#125; completion:^(BOOL finished) &#123;</div><div class="line">                [self checkTaskArrayWithAnimationCount:count];</div><div class="line">                NSLog(@&quot;end animation finish!&quot;);</div><div class="line">            &#125;];</div><div class="line">        &#125;else &#123;</div><div class="line">        //否则进入循环动画</div><div class="line">            [UIView animateWithDuration:cycleDuration.floatValue delay:0 options:UIViewAnimationOptionCurveLinear | UIViewAnimationOptionRepeat animations:^&#123;</div><div class="line">                [UIView setAnimationRepeatCount:repeatCount.integerValue];</div><div class="line">                switch (direction) &#123;</div><div class="line">                    case ScrollAnimationDirectionUp:</div><div class="line">                        [self setScrollCell:cell toNumber:10];</div><div class="line">                        break;</div><div class="line">                    case ScrollAnimationDirectionDown:</div><div class="line">                        [self setScrollCell:cell toNumber:0];</div><div class="line">                        break;</div><div class="line">                    default:</div><div class="line">                        break;</div><div class="line">                &#125;</div><div class="line">            &#125; completion:^(BOOL finished) &#123;</div><div class="line">                NSLog(@&quot;cycle animation finish!&quot;);</div><div class="line">                [self setScrollCell:cell toNumber:(direction == ScrollAnimationDirectionUp)?0 : 10];</div><div class="line">                //这是循环后的结束动画</div><div class="line">                [UIView animateWithDuration:endDuration.floatValue delay:0 options:UIViewAnimationOptionCurveEaseOut animations:^&#123;</div><div class="line">                    [self setScrollCell:cell toNumber:willDisplayNum.integerValue];</div><div class="line">                    &#125; completion:^(BOOL finished) &#123;</div><div class="line">                        [self checkTaskArrayWithAnimationCount:count];</div><div class="line">                        NSLog(@&quot;end animation finish!&quot;);</div><div class="line">                    &#125;];</div><div class="line">            &#125;];</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>核心动画部分代码都已经贴出来了，下面看下一些privite方法</p>
<h4 id="首先是每个动画结束的checkTaskArrayWithAnimationCount-方法"><a href="#首先是每个动画结束的checkTaskArrayWithAnimationCount-方法" class="headerlink" title="首先是每个动画结束的checkTaskArrayWithAnimationCount:方法"></a>首先是每个动画结束的checkTaskArrayWithAnimationCount:方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">//这里传入的cout是一次变化总共的动画次数</div><div class="line">- (void)checkTaskArrayWithAnimationCount:(NSInteger)count &#123;</div><div class="line">	//每个动画结束，计数加一，当等于count时，说明所有动画都已经结束了</div><div class="line">    self.finishedAnimationCount++;</div><div class="line">    if (self.finishedAnimationCount == count) &#123;</div><div class="line">        self.finishedAnimationCount = 0;</div><div class="line">        if (self.taskArray.count != 0) &#123;</div><div class="line">            NSDictionary *task = [self.taskArray objectAtIndex:0];</div><div class="line">            [self.taskArray removeObject:task];</div><div class="line">            NSNumber *displayNumber = [task objectForKey:keyTaskDisplayNumber];</div><div class="line">            NSNumber *changeNumber = [task objectForKey:keyTaskChangeNumber];</div><div class="line">            NSNumber *interval = [task objectForKey:keyTaskInterval];</div><div class="line">            //如果taskArray里有task，则进行下一次动画</div><div class="line">            [self playAnimationWithChange:changeNumber.integerValue displayNumber:displayNumber interval:interval.floatValue];</div><div class="line">        &#125;else &#123;</div><div class="line">            self.isAnimation = NO;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="计算列数的方法：calculateRowNumber"><a href="#计算列数的方法：calculateRowNumber" class="headerlink" title="计算列数的方法：calculateRowNumber:"></a>计算列数的方法：calculateRowNumber:</h4><p>这个方法很简单，就不做解释了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (NSInteger)calculateRowNumber:(NSInteger)number &#123;</div><div class="line">    NSInteger rowNumber = 1;</div><div class="line">    while ((number = number / 10) != 0) &#123;</div><div class="line">        rowNumber++;</div><div class="line">    &#125;</div><div class="line">    return rowNumber;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="使指定cell显示相应数值的方法：setScrollCell-toNumber"><a href="#使指定cell显示相应数值的方法：setScrollCell-toNumber" class="headerlink" title="使指定cell显示相应数值的方法：setScrollCell: toNumber:"></a>使指定cell显示相应数值的方法：setScrollCell: toNumber:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)setScrollCell:(UILabel *)cell toNumber:(NSInteger)number &#123;</div><div class="line">    CGFloat originX = cell.frame.origin.x;</div><div class="line">    CGFloat floatNumber = number;</div><div class="line">    CGFloat y = - ((CGFloat)floatNumber / 11) * self.cellHeight;</div><div class="line">    cell.frame = CGRectMake(originX, y, self.cellWidth, self.cellHeight);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="计算repeatCount的方法：getRepeatTimesWithChangeNumber-displayNumber"><a href="#计算repeatCount的方法：getRepeatTimesWithChangeNumber-displayNumber" class="headerlink" title="计算repeatCount的方法：getRepeatTimesWithChangeNumber: displayNumber:"></a>计算repeatCount的方法：getRepeatTimesWithChangeNumber: displayNumber:</h4><p>这个方法我想用几个小例子来解释，等看完这个例子，再去看代码就不会觉得那么难懂了：比如当前展示数为521，要让它改变到530，注意个位数要循环多少次呢，其实它只有开始部分和结束部分，并没有循环部分，我代码的操作是将个位置0，520和530，530-520=10，10/10^1=1所以得到的循环次数是1，而我前面说过这个1不是真正的循环次数，而是循环次数加上end部分的1，所以当repeatCount=1时，只会有开始动画和结束动画。再举一个例子：521和542，先置0，520和540，520-540=20，20/10^1=2，repeatCount=2，而真正循环次数为1，我们看，当521经过开始动画变位530，随后经过一个循环变为540，再经过结束动画到达542，那么真正循环确实是1次，说明这种算法没有问题。当然这只举了个位为例，其它位以此类推都是相同的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">- (NSArray&lt;NSNumber *&gt; *)getRepeatTimesWithChangeNumber:(NSInteger)change displayNumber:(NSInteger)number&#123;</div><div class="line">    NSMutableArray *repeatTimesArray = [[NSMutableArray alloc] init];</div><div class="line">    NSInteger originNumber = number - change;</div><div class="line">    if (change &gt; 0) &#123;</div><div class="line">        do &#123;</div><div class="line">            number = (number / 10) * 10;</div><div class="line">            originNumber = (originNumber / 10) * 10;</div><div class="line">            NSNumber *repeat = @((number - originNumber) / 10);</div><div class="line">            [repeatTimesArray addObject:repeat];</div><div class="line">            number = number / 10;</div><div class="line">            originNumber = originNumber / 10;</div><div class="line">        &#125; while ((number - originNumber) != 0);</div><div class="line">    &#125;else &#123;</div><div class="line">        do &#123;</div><div class="line">            number = (number / 10) * 10;</div><div class="line">            originNumber = (originNumber / 10) * 10;</div><div class="line">            NSNumber *repeat = @((originNumber - number) / 10);</div><div class="line">            [repeatTimesArray addObject:repeat];</div><div class="line">            number = number / 10;</div><div class="line">            originNumber = originNumber / 10;</div><div class="line">        &#125; while ((originNumber - number) != 0);</div><div class="line">    &#125;</div><div class="line">    return repeatTimesArray;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="将一个数字准换为各位上应当展示的数值的方法：getCellDisplayNumberWithNumber"><a href="#将一个数字准换为各位上应当展示的数值的方法：getCellDisplayNumberWithNumber" class="headerlink" title="将一个数字准换为各位上应当展示的数值的方法：getCellDisplayNumberWithNumber:"></a>将一个数字准换为各位上应当展示的数值的方法：getCellDisplayNumberWithNumber:</h4><p>举个例子就是这个数字是：521，则返回一个数组：[@1,@2,@5]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (NSArray&lt;NSNumber *&gt; *)getCellDisplayNumberWithNumber:(NSInteger)displayNumber &#123;</div><div class="line">    NSMutableArray *displayCellNumbers = [[NSMutableArray alloc] init];</div><div class="line">    NSInteger tmpNumber;</div><div class="line">    for (NSInteger i = 0; i &lt; self.rowNumber; i++) &#123;</div><div class="line">        tmpNumber = displayNumber % 10;</div><div class="line">        NSNumber *number = @(tmpNumber);</div><div class="line">        [displayCellNumbers addObject:number];</div><div class="line">        displayNumber = displayNumber / 10;</div><div class="line">    &#125;</div><div class="line">    return displayCellNumbers;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="获得指定cell展示的数值的方法：getDisplayNumberOfCell"><a href="#获得指定cell展示的数值的方法：getDisplayNumberOfCell" class="headerlink" title="获得指定cell展示的数值的方法：getDisplayNumberOfCell:"></a>获得指定cell展示的数值的方法：getDisplayNumberOfCell:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (NSInteger)getDisplayNumberOfCell:(UILabel *)cell &#123;</div><div class="line">    CGFloat y = cell.frame.origin.y;</div><div class="line">    CGFloat tmpNumber = (- (y * 11 / self.cellHeight));</div><div class="line">    NSInteger displayNumber = (NSInteger)roundf(tmpNumber);</div><div class="line">    return displayNumber;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="计算动画总时间的方法：getIntervalWithOriginalNumber-displayNumber"><a href="#计算动画总时间的方法：getIntervalWithOriginalNumber-displayNumber" class="headerlink" title="计算动画总时间的方法：getIntervalWithOriginalNumber: displayNumber:"></a>计算动画总时间的方法：getIntervalWithOriginalNumber: displayNumber:</h4><p>这个时间是根据最高位改变的位数来计算的，位数越高，每改变一次时间就越长。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">static const CGFloat normalModulus = 0.3f;</div><div class="line"></div><div class="line">- (CGFloat)getIntervalWithOriginalNumber:(NSInteger)number displayNumber:(NSInteger)displayNumber &#123;</div><div class="line">    </div><div class="line">    NSArray *repeatTimesArray = [self getRepeatTimesWithChangeNumber:displayNumber - number displayNumber:displayNumber];</div><div class="line">    NSUInteger count = repeatTimesArray.count;</div><div class="line">    NSInteger tmp1 = displayNumber / (NSInteger)pow(10, count - 1);</div><div class="line">    NSInteger tmp2 = number / (NSInteger)pow(10, count - 1);</div><div class="line">    </div><div class="line">    NSLog(@&quot;tmp1:%ld tmp2:%ld&quot;, (long)tmp1, (long)tmp2);</div><div class="line">    NSInteger maxChangeNum = labs(tmp1 % 10 - tmp2 % 10);</div><div class="line">    </div><div class="line">    return normalModulus * count * maxChangeNum;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>代码部分到此结束</p>
<h4 id="github地址：https-github-com-948080952-DPScrollNumberLabel"><a href="#github地址：https-github-com-948080952-DPScrollNumberLabel" class="headerlink" title="github地址：https://github.com/948080952/DPScrollNumberLabel"></a>github地址：<a href="https://github.com/948080952/DPScrollNumberLabel" title="https://github.com/948080952/DPScrollNumberLabel">https://github.com/948080952/DPScrollNumberLabel</a></h4><p>如果觉得我的代码对你有用处，请在github上给我一个赞，谢谢！</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS开发/" rel="tag"># iOS开发</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/login_incorrect_problem_on_mac/" rel="prev" title="mac终端Login Incorrect问题">
                mac终端Login Incorrect问题 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/daipei.jpg"
               alt="DaiPei" />
          <p class="site-author-name" itemprop="name">DaiPei</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/948080952" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/daipeihust" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#写在前面"><span class="nav-number">1.</span> <span class="nav-text">写在前面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#正文"><span class="nav-number">2.</span> <span class="nav-text">正文</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简介"><span class="nav-number">2.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现思路"><span class="nav-number">2.2.</span> <span class="nav-text">实现思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Talk-is-cheap，show-you-The-code！"><span class="nav-number">2.3.</span> <span class="nav-text">Talk is cheap，show you The code！</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#首先看一下头文件里的内容："><span class="nav-number">2.3.1.</span> <span class="nav-text">首先看一下头文件里的内容：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#下面只贴上其中一个init方法："><span class="nav-number">2.3.2.</span> <span class="nav-text">下面只贴上其中一个init方法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#初始化后进入commonInit方法："><span class="nav-number">2.3.3.</span> <span class="nav-text">初始化后进入commonInit方法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#然后先初始化cell，再初始化parent："><span class="nav-number">2.3.4.</span> <span class="nav-text">然后先初始化cell，再初始化parent：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#下面让我们关注头文件里另外的两个公有方法："><span class="nav-number">2.3.5.</span> <span class="nav-text">下面让我们关注头文件里另外的两个公有方法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#下面就要进入动画部分了"><span class="nav-number">2.3.6.</span> <span class="nav-text">下面就要进入动画部分了</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#下面贴出single和multi两种动画的代码："><span class="nav-number">2.3.7.</span> <span class="nav-text">下面贴出single和multi两种动画的代码：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#首先是每个动画结束的checkTaskArrayWithAnimationCount-方法"><span class="nav-number">2.3.8.</span> <span class="nav-text">首先是每个动画结束的checkTaskArrayWithAnimationCount:方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#计算列数的方法：calculateRowNumber"><span class="nav-number">2.3.9.</span> <span class="nav-text">计算列数的方法：calculateRowNumber:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使指定cell显示相应数值的方法：setScrollCell-toNumber"><span class="nav-number">2.3.10.</span> <span class="nav-text">使指定cell显示相应数值的方法：setScrollCell: toNumber:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#计算repeatCount的方法：getRepeatTimesWithChangeNumber-displayNumber"><span class="nav-number">2.3.11.</span> <span class="nav-text">计算repeatCount的方法：getRepeatTimesWithChangeNumber: displayNumber:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#将一个数字准换为各位上应当展示的数值的方法：getCellDisplayNumberWithNumber"><span class="nav-number">2.3.12.</span> <span class="nav-text">将一个数字准换为各位上应当展示的数值的方法：getCellDisplayNumberWithNumber:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获得指定cell展示的数值的方法：getDisplayNumberOfCell"><span class="nav-number">2.3.13.</span> <span class="nav-text">获得指定cell展示的数值的方法：getDisplayNumberOfCell:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#计算动画总时间的方法：getIntervalWithOriginalNumber-displayNumber"><span class="nav-number">2.3.14.</span> <span class="nav-text">计算动画总时间的方法：getIntervalWithOriginalNumber: displayNumber:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#github地址：https-github-com-948080952-DPScrollNumberLabel"><span class="nav-number">2.3.15.</span> <span class="nav-text">github地址：https://github.com/948080952/DPScrollNumberLabel</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DaiPei</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  







  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/three/three.min.js"></script>

  
  <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  
    
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "b24ff215c66d4c03bc1702fbdff177d3",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
  










  





  

  

  

  

  

  

</body>
</html>
